<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="100kg">
    <meta name="theme-color" content="#0A0A0F">
    <title>100kg</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --bg: #0A0A0F;
            --card-bg: #14141A;
            --text: #FFFFFF;
            --text-dim: #888;
            --mon: #FF6B35;
            --tue: #FF4444;
            --wed: #4488FF;
            --thu: #44DD66;
            --fri: #AA66FF;
            --sat: #FFD700;
            --sun: #00CED1;
            --food: #FF6B35;
            --habits: #00CED1;
            --review: #FF69B4;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            padding-top: env(safe-area-inset-top, 20px);
            padding-bottom: calc(env(safe-area-inset-bottom, 20px) + 80px);
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
            letter-spacing: -1px;
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 5px;
        }

        .tab-btn {
            flex: 1;
            min-width: 60px;
            background: var(--card-bg);
            border: none;
            color: var(--text-dim);
            font-family: inherit;
            font-size: 0.8rem;
            font-weight: 500;
            padding: 12px 6px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab-btn.active {
            color: var(--text);
            background: #222;
        }

        .tab-btn.active.week { border-bottom: 3px solid var(--tue); }
        .tab-btn.active.food { border-bottom: 3px solid var(--food); }
        .tab-btn.active.habits { border-bottom: 3px solid var(--habits); }
        .tab-btn.active.review { border-bottom: 3px solid var(--review); }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .week-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
        }

        .week-nav button {
            background: var(--card-bg);
            border: none;
            color: var(--text);
            font-size: 1.5rem;
            width: 44px;
            height: 44px;
            border-radius: 12px;
            cursor: pointer;
        }

        .week-nav span {
            font-size: 1.1rem;
            font-weight: 500;
            min-width: 100px;
            text-align: center;
        }

        .weekly-progress {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .weekly-progress-label {
            font-size: 0.85rem;
            color: var(--text-dim);
            margin-bottom: 8px;
        }

        .weekly-progress-bar {
            height: 8px;
            background: #222;
            border-radius: 4px;
            overflow: hidden;
        }

        .weekly-progress-fill {
            height: 100%;
            background: var(--mon);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .day-cards {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .day-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 18px;
            cursor: pointer;
            border-left: 4px solid;
            transition: transform 0.2s ease;
        }

        .day-card:active {
            transform: scale(0.98);
        }

        .day-card.mon { border-color: var(--mon); }
        .day-card.tue { border-color: var(--tue); }
        .day-card.wed { border-color: var(--wed); }
        .day-card.thu { border-color: var(--thu); }
        .day-card.fri { border-color: var(--fri); }
        .day-card.sat { border-color: var(--sat); }
        .day-card.sun { border-color: var(--sun); }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .day-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .day-subtitle {
            font-size: 0.85rem;
            color: var(--text-dim);
        }

        .day-date {
            font-size: 0.75rem;
            color: var(--text-dim);
            margin-top: 4px;
        }

        .day-progress {
            height: 6px;
            background: #222;
            border-radius: 3px;
            overflow: hidden;
        }

        .day-progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .mon .day-progress-fill { background: var(--mon); }
        .tue .day-progress-fill { background: var(--tue); }
        .wed .day-progress-fill { background: var(--wed); }
        .thu .day-progress-fill { background: var(--thu); }
        .fri .day-progress-fill { background: var(--fri); }
        .sat .day-progress-fill { background: var(--sat); }
        .sun .day-progress-fill { background: var(--sun); }

        /* Day Detail View */
        .day-detail {
            display: none;
        }

        .day-detail.active {
            display: block;
        }

        .back-btn {
            background: var(--card-bg);
            border: none;
            color: var(--text);
            font-size: 1rem;
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .exercise-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .exercise-item {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
        }

        .exercise-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .exercise-checkbox, .habit-checkbox, .meal-checkbox {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            border: 2px solid #444;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .exercise-checkbox.checked, .habit-checkbox.checked, .meal-checkbox.checked {
            background: #44DD66;
            border-color: #44DD66;
        }

        .exercise-checkbox.checked::after, .habit-checkbox.checked::after, .meal-checkbox.checked::after {
            content: '‚úì';
            color: #000;
            font-weight: bold;
            font-size: 16px;
        }

        .exercise-name {
            flex: 1;
            font-weight: 500;
        }

        .exercise-name.completed {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .youtube-btn {
            width: 40px;
            height: 40px;
            background: #FF0000;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .youtube-btn svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        .exercise-sets {
            font-size: 0.85rem;
            color: var(--text-dim);
            margin-bottom: 10px;
            padding-left: 40px;
        }

        .weight-input-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding-left: 40px;
        }

        .weight-input-row label {
            font-size: 0.85rem;
            color: var(--text-dim);
        }

        .weight-input {
            width: 80px;
            background: #222;
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            color: var(--text);
            font-family: inherit;
            font-size: 1rem;
            text-align: center;
        }

        .weight-input:focus {
            outline: 2px solid #444;
        }

        .add-exercise-btn {
            width: 100%;
            background: #222;
            border: 2px dashed #444;
            border-radius: 12px;
            padding: 15px;
            color: var(--text-dim);
            font-family: inherit;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 15px;
        }

        .add-exercise-btn:active {
            background: #333;
        }

        /* Section styles */
        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 30px 0 15px;
        }

        .section-title:first-child {
            margin-top: 0;
        }

        .bodyweight-section, .card-section {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 18px;
            margin-bottom: 15px;
        }

        .bodyweight-input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .bodyweight-input, .text-input {
            flex: 1;
            background: #222;
            border: none;
            border-radius: 10px;
            padding: 12px 15px;
            color: var(--text);
            font-family: inherit;
            font-size: 1rem;
        }

        .bodyweight-input:focus, .text-input:focus {
            outline: 2px solid #444;
        }

        .add-weight-btn, .add-btn {
            background: var(--sat);
            border: none;
            border-radius: 10px;
            padding: 12px 20px;
            color: #000;
            font-family: inherit;
            font-weight: 600;
            cursor: pointer;
        }

        .weight-log {
            max-height: 200px;
            overflow-y: auto;
        }

        .weight-entry {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #222;
        }

        .weight-entry:last-child {
            border-bottom: none;
        }

        .weight-date {
            color: var(--text-dim);
            font-size: 0.9rem;
        }

        .weight-value {
            font-weight: 600;
        }

        .weight-change {
            font-size: 0.8rem;
            margin-left: 8px;
        }

        .weight-change.down { color: var(--thu); }
        .weight-change.up { color: var(--tue); }

        .tip {
            text-align: center;
            color: var(--text-dim);
            font-size: 0.85rem;
            margin-top: 30px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 12px;
            font-style: italic;
        }

        .home-view.hidden {
            display: none;
        }

        /* Food Tab Styles */
        .date-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .date-nav button {
            background: var(--card-bg);
            border: none;
            color: var(--text);
            font-size: 1.2rem;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            cursor: pointer;
        }

        .date-nav span {
            font-size: 1rem;
            font-weight: 500;
            min-width: 140px;
            text-align: center;
        }

        .meal-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 18px;
            margin-bottom: 15px;
            border-left: 4px solid var(--food);
        }

        .meal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .meal-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .meal-inputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .meal-inputs input {
            background: #222;
            border: none;
            border-radius: 10px;
            padding: 12px 15px;
            color: var(--text);
            font-family: inherit;
            font-size: 1rem;
        }

        .meal-inputs input:focus {
            outline: 2px solid var(--food);
        }

        .meal-inputs input::placeholder {
            color: #555;
        }

        .clean-check {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 10px;
            padding: 10px;
            background: #1a1a22;
            border-radius: 10px;
        }

        .clean-check span {
            font-size: 0.9rem;
            color: var(--text-dim);
        }

        .diet-rules {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .diet-rules h3 {
            font-size: 0.9rem;
            color: var(--food);
            margin-bottom: 10px;
        }

        .diet-rules ul {
            list-style: none;
            font-size: 0.85rem;
            color: var(--text-dim);
        }

        .diet-rules li {
            padding: 4px 0;
        }

        .diet-rules li::before {
            content: '‚úó ';
            color: var(--tue);
        }

        .diet-rules li.allowed::before {
            content: '‚úì ';
            color: var(--thu);
        }

        .claude-check {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 18px;
            background: linear-gradient(135deg, #2a1a1a 0%, #1a1a2a 100%);
            border-radius: 16px;
            border: 1px solid #333;
            cursor: pointer;
            margin-top: 15px;
        }

        .claude-check:active {
            transform: scale(0.98);
        }

        .claude-icon {
            font-size: 1.8rem;
        }

        .claude-text {
            flex: 1;
        }

        .claude-title {
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 4px;
        }

        .claude-subtitle {
            font-size: 0.85rem;
            color: var(--text-dim);
        }

        .claude-arrow {
            font-size: 1.2rem;
            color: var(--text-dim);
        }

        /* Habits Tab Styles */
        .habit-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .habit-name {
            flex: 1;
            font-weight: 500;
        }

        .habit-name.completed {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .delete-btn {
            background: transparent;
            border: none;
            color: var(--tue);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
        }

        .add-habit-row {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .habit-streak {
            font-size: 0.8rem;
            color: var(--sat);
            background: rgba(255, 215, 0, 0.1);
            padding: 4px 8px;
            border-radius: 6px;
        }

        /* Review Tab Styles */
        .review-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .review-card h3 {
            font-size: 1rem;
            margin-bottom: 15px;
            color: var(--review);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #222;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: var(--text-dim);
        }

        .stat-value {
            font-weight: 600;
        }

        .stat-value.good { color: var(--thu); }
        .stat-value.bad { color: var(--tue); }
        .stat-value.neutral { color: var(--sat); }

        .verdict {
            background: #1a1a22;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid var(--review);
        }

        .verdict h4 {
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .verdict p {
            font-size: 0.95rem;
            line-height: 1.5;
            color: var(--text-dim);
        }

        .verdict .highlight {
            color: var(--text);
            font-weight: 500;
        }

        .generate-btn {
            width: 100%;
            background: var(--review);
            border: none;
            border-radius: 12px;
            padding: 15px;
            color: #000;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
        }

        /* PT Session card */
        .pt-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            border-left: 4px solid var(--mon);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .pt-info {
            flex: 1;
        }

        .pt-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 4px;
        }

        .pt-subtitle {
            font-size: 0.9rem;
            color: var(--text-dim);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            width: 100%;
            max-width: 400px;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .modal-input {
            width: 100%;
            background: #222;
            border: none;
            border-radius: 10px;
            padding: 15px;
            color: var(--text);
            font-family: inherit;
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }

        .modal-btn.cancel {
            background: #333;
            color: var(--text);
        }

        .modal-btn.save {
            background: var(--thu);
            color: #000;
        }
    </style>
</head>
<body>
    <h1>100kg</h1>

    <!-- Tab Navigation -->
    <div class="tab-nav">
        <button class="tab-btn week active" onclick="showTab('week')">Week</button>
        <button class="tab-btn food" onclick="showTab('food')">Food</button>
        <button class="tab-btn habits" onclick="showTab('habits')">Habits</button>
        <button class="tab-btn review" onclick="showTab('review')">Review</button>
        <button class="tab-btn" onclick="showTab('backup')" style="margin-left:auto">‚öôÔ∏è</button>
    </div>

    <!-- Week Tab -->
    <div id="weekTab" class="tab-content active">
        <div id="homeView" class="home-view">
            <div class="week-nav">
                <button onclick="changeWeek(-1)">‚Üê</button>
                <span id="weekLabel">Week 1</span>
                <button onclick="changeWeek(1)">‚Üí</button>
            </div>

            <div class="weekly-progress">
                <div class="weekly-progress-label">Weekly Progress</div>
                <div class="weekly-progress-bar">
                    <div id="weeklyProgressFill" class="weekly-progress-fill" style="width: 0%"></div>
                </div>
            </div>

            <div class="day-cards" id="dayCards"></div>

            <div class="section-title">Bodyweight Log</div>
            <div class="bodyweight-section">
                <div class="bodyweight-input-row">
                    <input type="number" step="0.1" class="bodyweight-input" id="bodyweightInput" placeholder="Enter weight (kg)">
                    <button class="add-weight-btn" onclick="addBodyweight()">Log</button>
                </div>
                <div class="weight-log" id="weightLog"></div>
            </div>

            <div class="tip">Hit targets consistently to fuck the gut off</div>
        </div>

        <!-- Day Detail View -->
        <div id="dayDetail" class="day-detail">
            <button class="back-btn" onclick="showHome()">‚Üê Back</button>
            <h2 class="detail-title" id="detailTitle"></h2>
            <div class="exercise-list" id="exerciseList"></div>
            <button class="add-exercise-btn" onclick="showAddExerciseModal()">+ Add Exercise</button>
        </div>
    </div>

    <!-- Food Tab -->
    <div id="foodTab" class="tab-content">
        <div class="diet-rules">
            <h3>Rodzen Protocol</h3>
            <ul>
                <li>Sugar</li>
                <li>Carbs (bread, pasta, rice, potatoes)</li>
                <li>Root vegetables (below ground)</li>
                <li class="allowed">Protein (meat, fish, eggs)</li>
                <li class="allowed">Veg that grows above ground</li>
                <li class="allowed">2 meals per day only</li>
            </ul>
        </div>

        <div class="date-nav">
            <button onclick="changeDate(-1)">‚Üê</button>
            <span id="dateLabel">Today</span>
            <button onclick="changeDate(1)">‚Üí</button>
        </div>

        <div class="meal-card">
            <div class="meal-header">
                <span class="meal-title">Meal 1</span>
            </div>
            <div class="meal-inputs">
                <input type="text" id="meal1Protein" placeholder="Protein (e.g. chicken, steak, eggs)" oninput="saveMeal(1)">
                <input type="text" id="meal1Veg" placeholder="Veg above ground (e.g. broccoli, spinach)" oninput="saveMeal(1)">
            </div>
            <div class="clean-check">
                <div class="meal-checkbox" id="meal1Clean" onclick="toggleMealClean(1)"></div>
                <span>Clean meal (no sugar/carbs)</span>
            </div>
        </div>

        <div class="meal-card">
            <div class="meal-header">
                <span class="meal-title">Meal 2</span>
            </div>
            <div class="meal-inputs">
                <input type="text" id="meal2Protein" placeholder="Protein (e.g. salmon, beef, pork)" oninput="saveMeal(2)">
                <input type="text" id="meal2Veg" placeholder="Veg above ground (e.g. peppers, zucchini)" oninput="saveMeal(2)">
            </div>
            <div class="clean-check">
                <div class="meal-checkbox" id="meal2Clean" onclick="toggleMealClean(2)"></div>
                <span>Clean meal (no sugar/carbs)</span>
            </div>
        </div>

        <div class="card-section">
            <div class="section-title" style="margin-top:0">Notes</div>
            <textarea id="foodNotes" class="text-input" style="width:100%; min-height:60px; resize:vertical" placeholder="What did you eat/drink? (black coffee, water, etc.)" oninput="saveFoodNotes()"></textarea>
        </div>

        <div class="card-section" style="border-left: 3px solid var(--tue);">
            <div class="clean-check" style="margin-bottom:10px">
                <div class="meal-checkbox" id="cheatCheckbox" onclick="toggleCheat()"></div>
                <span>I cheated today</span>
            </div>
            <textarea id="cheatNotes" class="text-input" style="width:100%; min-height:50px; resize:vertical" placeholder="What was it? (pizza, chocolate, etc.)" oninput="saveCheatNotes()"></textarea>
        </div>

        <div class="claude-check" onclick="openClaude()">
            <span class="claude-icon">üì∏</span>
            <div class="claude-text">
                <div class="claude-title">Not sure if it's clean?</div>
                <div class="claude-subtitle">Snap a photo ‚Üí Ask Claude</div>
            </div>
            <span class="claude-arrow">‚Üí</span>
        </div>
    </div>

    <!-- Habits Tab -->
    <div id="habitsTab" class="tab-content">
        <div class="date-nav">
            <button onclick="changeHabitDate(-1)">‚Üê</button>
            <span id="habitDateLabel">Today</span>
            <button onclick="changeHabitDate(1)">‚Üí</button>
        </div>

        <div id="habitsList"></div>

        <div class="add-habit-row">
            <input type="text" class="text-input" id="newHabitInput" placeholder="Add new habit...">
            <button class="add-btn" onclick="addHabit()">Add</button>
        </div>

        <div class="tip" style="margin-top:20px">Default habits: Vitamins, Creatine, Water 3L, 8hrs Sleep</div>
    </div>

    <!-- Backup Tab -->
    <div id="backupTab" class="tab-content">
        <div class="card-section">
            <div class="section-title" style="margin-top:0">Backup & Restore</div>
            <button class="generate-btn" onclick="exportData()" style="background: var(--thu)">Download Backup</button>
            <button class="generate-btn" onclick="document.getElementById('importFile').click()" style="background: var(--sat); margin-top:10px">Restore Backup</button>
            <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
            <div class="tip" style="margin-top:20px">Backup your data regularly to avoid losing progress if you clear Safari data.</div>
        </div>
    </div>

    <!-- Review Tab -->
    <div id="reviewTab" class="tab-content">
        <div class="week-nav">
            <button onclick="changeReviewWeek(-1)">‚Üê</button>
            <span id="reviewWeekLabel">Week 1</span>
            <button onclick="changeReviewWeek(1)">‚Üí</button>
        </div>

        <div class="review-card">
            <h3>Workout Stats</h3>
            <div id="workoutStats"></div>
        </div>

        <div class="review-card">
            <h3>Diet Compliance</h3>
            <div id="dietStats"></div>
        </div>

        <div class="review-card">
            <h3>Habit Completion</h3>
            <div id="habitStats"></div>
        </div>

        <div class="review-card">
            <h3>Weight Change</h3>
            <div id="weightStats"></div>
        </div>

        <button class="generate-btn" onclick="generateVerdict()">Why Am I Still Fat?</button>

        <div class="verdict" id="verdict" style="display:none">
            <h4>The Verdict</h4>
            <p id="verdictText"></p>
        </div>
    </div>

    <!-- Add Exercise Modal -->
    <div class="modal" id="addExerciseModal">
        <div class="modal-content">
            <div class="modal-title">Add Exercise</div>
            <input type="text" class="modal-input" id="newExerciseName" placeholder="Exercise name">
            <input type="text" class="modal-input" id="newExerciseSets" placeholder="Sets (e.g. 3x10)">
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="hideAddExerciseModal()">Cancel</button>
                <button class="modal-btn save" onclick="addCustomExercise()">Add</button>
            </div>
        </div>
    </div>

    <script>
        // 7-day workout structure
        const weekDays = {
            mon: {
                name: "Monday",
                title: "Marcelo PT",
                color: "mon",
                isPT: true,
                exercises: []
            },
            tue: {
                name: "Tuesday",
                title: "Push",
                color: "tue",
                exercises: [
                    { name: "Bench Press", sets: "4x8-10" },
                    { name: "Overhead Press", sets: "3x10-12" },
                    { name: "Incline Dumbbell Press", sets: "3x10-12" },
                    { name: "Lateral Raises", sets: "3x12-15" },
                    { name: "Tricep Pushdowns", sets: "3x12-15" },
                    { name: "Cardio", sets: "20 mins" }
                ]
            },
            wed: {
                name: "Wednesday",
                title: "Pull",
                color: "wed",
                exercises: [
                    { name: "Deadlift", sets: "4x6-8" },
                    { name: "Lat Pulldowns / Assisted Pull-Ups", sets: "3x8-10" },
                    { name: "Seated Rows", sets: "3x10-12" },
                    { name: "Barbell Curls", sets: "3x10-12" },
                    { name: "Hammer Curls", sets: "3x12-15" },
                    { name: "Face Pulls", sets: "3x15" },
                    { name: "HIIT", sets: "10 mins" }
                ]
            },
            thu: {
                name: "Thursday",
                title: "Legs + Cardio",
                color: "thu",
                exercises: [
                    { name: "Zercher Squats", sets: "4x8-10" },
                    { name: "Leg Press / Hack Squat", sets: "3x10-12" },
                    { name: "Romanian Deadlifts", sets: "3x10-12" },
                    { name: "Calf Raises", sets: "3x15" },
                    { name: "Interval Cardio", sets: "30 mins" }
                ]
            },
            fri: {
                name: "Friday",
                title: "Upper + Full Body",
                color: "fri",
                exercises: [
                    { name: "Dumbbell Shoulder Press", sets: "4x10-12" },
                    { name: "Bench Press", sets: "3x6-8" },
                    { name: "Assisted Pull-Ups", sets: "3x max" },
                    { name: "EZ-Bar Curls", sets: "3x10-12" },
                    { name: "Dips", sets: "3x10-12" },
                    { name: "Core Circuit", sets: "3x30-60s" },
                    { name: "HIIT Cardio", sets: "20 mins" }
                ]
            },
            sat: {
                name: "Saturday",
                title: "Rest / Active",
                color: "sat",
                isRest: true,
                exercises: []
            },
            sun: {
                name: "Sunday",
                title: "Rest / Active",
                color: "sun",
                isRest: true,
                exercises: []
            }
        };

        const dayOrder = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'];

        const defaultHabits = [
            "Take vitamins",
            "Take creatine",
            "Drink 3L water",
            "8 hours sleep"
        ];

        let currentWeek = 1;
        let currentDay = null;
        let currentDate = new Date();
        let habitDate = new Date();
        let reviewWeek = 1;

        // Data functions
        function getData() {
            const data = localStorage.getItem('workout100kg');
            if (data) {
                return JSON.parse(data);
            }
            return {
                weeks: {},
                bodyweight: [],
                meals: {},
                habits: defaultHabits.slice(),
                habitLog: {},
                foodNotes: {}
            };
        }

        function saveData(data) {
            localStorage.setItem('workout100kg', JSON.stringify(data));
        }

        function getDateKey(date) {
            return date.toISOString().split('T')[0];
        }

        function formatDate(date) {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);

            if (getDateKey(date) === getDateKey(today)) return 'Today';
            if (getDateKey(date) === getDateKey(yesterday)) return 'Yesterday';
            if (getDateKey(date) === getDateKey(tomorrow)) return 'Tomorrow';

            return date.toLocaleDateString('en-GB', { weekday: 'short', day: 'numeric', month: 'short' });
        }

        // Week 1 starts Monday Feb 23, 2026
        const PROGRAM_START = new Date('2026-02-23T00:00:00');

        function getWeekStartDate(weekNum) {
            const weekStart = new Date(PROGRAM_START);
            weekStart.setDate(PROGRAM_START.getDate() + (weekNum - 1) * 7);
            return weekStart;
        }

        function getCurrentWeekNumber() {
            const now = new Date();
            now.setHours(0, 0, 0, 0);
            const diffDays = Math.floor((now - PROGRAM_START) / (1000 * 60 * 60 * 24));
            if (diffDays < 0) return 1; // Before program starts
            return Math.floor(diffDays / 7) + 1;
        }

        // Tab Navigation
        function showTab(tab) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));

            document.getElementById(tab + 'Tab').classList.add('active');
            document.querySelector(`.tab-btn.${tab}`).classList.add('active');

            if (tab === 'food') loadFoodData();
            if (tab === 'habits') renderHabits();
            if (tab === 'review') updateReviewStats();
        }

        // Week functions
        function getWeekData(week) {
            const data = getData();
            if (!data.weeks[week]) {
                data.weeks[week] = {};
                dayOrder.forEach(day => {
                    const dayInfo = weekDays[day];
                    data.weeks[week][day] = {
                        completed: false,
                        exercises: dayInfo.exercises.map(e => ({
                            name: e.name,
                            sets: e.sets,
                            completed: false,
                            weight: '',
                            isCustom: false
                        })),
                        customExercises: []
                    };
                });
                saveData(data);
            }
            return data.weeks[week];
        }

        function changeWeek(delta) {
            currentWeek = Math.max(1, currentWeek + delta);
            document.getElementById('weekLabel').textContent = `Week ${currentWeek}`;
            renderDayCards();
        }

        function getDayProgress(week, day) {
            const weekData = getWeekData(week);
            const dayData = weekData[day];
            const dayInfo = weekDays[day];

            if (dayInfo.isPT) {
                return dayData.completed ? 100 : 0;
            }

            if (dayInfo.isRest) {
                // Rest days only count if user added exercises
                if (dayData.customExercises && dayData.customExercises.length > 0) {
                    return (dayData.customExercises.filter(e => e.completed).length / dayData.customExercises.length) * 100;
                }
                return 0;
            }

            const allExercises = [...dayData.exercises, ...(dayData.customExercises || [])];
            if (allExercises.length === 0) return 0;
            const completed = allExercises.filter(e => e.completed).length;
            return (completed / allExercises.length) * 100;
        }

        function getWeeklyProgress() {
            // Only count Mon-Fri (5 workout days) for weekly progress
            let totalProgress = 0;
            ['mon', 'tue', 'wed', 'thu', 'fri'].forEach(day => {
                totalProgress += getDayProgress(currentWeek, day);
            });
            return totalProgress / 5;
        }

        function renderDayCards() {
            const container = document.getElementById('dayCards');
            container.innerHTML = '';
            const weekData = getWeekData(currentWeek);
            const weekStart = getWeekStartDate(currentWeek);

            dayOrder.forEach((day, index) => {
                const dayInfo = weekDays[day];
                const dayData = weekData[day];
                const progress = getDayProgress(currentWeek, day);

                const dayDate = new Date(weekStart);
                dayDate.setDate(weekStart.getDate() + index);
                const dateStr = dayDate.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' });

                const card = document.createElement('div');
                card.className = `day-card ${dayInfo.color}`;
                card.onclick = () => showDay(day);

                const exerciseCount = dayInfo.isPT ? '' :
                    dayInfo.isRest ? (dayData.customExercises?.length || 0) + ' exercises' :
                    (dayInfo.exercises.length + (dayData.customExercises?.length || 0)) + ' exercises';

                card.innerHTML = `
                    <div class="day-header">
                        <div>
                            <div class="day-title">${dayInfo.name}: ${dayInfo.title}</div>
                            <div class="day-subtitle">${exerciseCount}</div>
                            <div class="day-date">${dateStr}</div>
                        </div>
                        <div class="day-subtitle">${Math.round(progress)}%</div>
                    </div>
                    <div class="day-progress">
                        <div class="day-progress-fill" style="width: ${progress}%"></div>
                    </div>
                `;

                container.appendChild(card);
            });

            document.getElementById('weeklyProgressFill').style.width = `${getWeeklyProgress()}%`;
        }

        function showDay(day) {
            currentDay = day;
            const dayInfo = weekDays[day];
            const weekData = getWeekData(currentWeek);
            const dayData = weekData[day];

            document.getElementById('homeView').classList.add('hidden');
            document.getElementById('dayDetail').classList.add('active');
            document.getElementById('detailTitle').textContent = `${dayInfo.name}: ${dayInfo.title}`;

            const container = document.getElementById('exerciseList');
            container.innerHTML = '';

            if (dayInfo.isPT) {
                // PT Session - just a big checkbox
                const ptCard = document.createElement('div');
                ptCard.className = 'pt-card';
                ptCard.innerHTML = `
                    <div class="exercise-checkbox ${dayData.completed ? 'checked' : ''}"
                         onclick="togglePTComplete()"></div>
                    <div class="pt-info">
                        <div class="pt-title">Session with Marcelo</div>
                        <div class="pt-subtitle">Personal Training</div>
                    </div>
                `;
                container.appendChild(ptCard);
            } else {
                // Regular workout day
                const allExercises = [...dayData.exercises];

                allExercises.forEach((exercise, index) => {
                    const item = createExerciseItem(exercise, index, false);
                    container.appendChild(item);
                });

                // Custom exercises
                if (dayData.customExercises) {
                    dayData.customExercises.forEach((exercise, index) => {
                        const item = createExerciseItem(exercise, index, true);
                        container.appendChild(item);
                    });
                }
            }
        }

        function createExerciseItem(exercise, index, isCustom) {
            const item = document.createElement('div');
            item.className = 'exercise-item';

            const isCardio = exercise.name.toLowerCase().includes('cardio') ||
                             exercise.name.toLowerCase().includes('hiit') ||
                             exercise.name.toLowerCase().includes('core circuit');

            item.innerHTML = `
                <div class="exercise-header">
                    <div class="exercise-checkbox ${exercise.completed ? 'checked' : ''}"
                         onclick="toggleExercise(${index}, ${isCustom})"></div>
                    <div class="exercise-name ${exercise.completed ? 'completed' : ''}">${exercise.name}</div>
                    ${isCustom ? `<button class="delete-btn" onclick="deleteExercise(${index})">√ó</button>` : ''}
                    <button class="youtube-btn" onclick="openYouTube('${exercise.name}')">
                        <svg viewBox="0 0 24 24"><path d="M10 15l5.19-3L10 9v6m11.56-7.83c.13.47.22 1.1.28 1.9.07.8.1 1.49.1 2.09L22 12c0 2.19-.16 3.8-.44 4.83-.25.9-.83 1.48-1.73 1.73-.47.13-1.33.22-2.65.28-1.3.07-2.49.1-3.59.1L12 19c-4.19 0-6.8-.16-7.83-.44-.9-.25-1.48-.83-1.73-1.73-.13-.47-.22-1.1-.28-1.9-.07-.8-.1-1.49-.1-2.09L2 12c0-2.19.16-3.8.44-4.83.25-.9.83-1.48 1.73-1.73.47-.13 1.33-.22 2.65-.28 1.3-.07 2.49-.1 3.59-.1L12 5c4.19 0 6.8.16 7.83.44.9.25 1.48.83 1.73 1.73z"/></svg>
                    </button>
                </div>
                <div class="exercise-sets">${exercise.sets}</div>
                ${!isCardio ? `
                <div class="weight-input-row">
                    <label>Weight:</label>
                    <input type="number" step="0.5" class="weight-input"
                           value="${exercise.weight || ''}"
                           onchange="updateWeight(${index}, ${isCustom}, this.value)"
                           placeholder="kg">
                    <span>kg</span>
                </div>
                ` : ''}
            `;

            return item;
        }

        function togglePTComplete() {
            const data = getData();
            data.weeks[currentWeek][currentDay].completed = !data.weeks[currentWeek][currentDay].completed;
            saveData(data);
            showDay(currentDay);
        }

        function toggleExercise(index, isCustom) {
            const data = getData();
            const dayData = data.weeks[currentWeek][currentDay];

            if (isCustom) {
                dayData.customExercises[index].completed = !dayData.customExercises[index].completed;
            } else {
                dayData.exercises[index].completed = !dayData.exercises[index].completed;
            }

            saveData(data);
            showDay(currentDay);
        }

        function updateWeight(index, isCustom, weight) {
            const data = getData();
            const dayData = data.weeks[currentWeek][currentDay];

            if (isCustom) {
                dayData.customExercises[index].weight = weight;
            } else {
                dayData.exercises[index].weight = weight;
            }

            saveData(data);
        }

        function deleteExercise(index) {
            const data = getData();
            data.weeks[currentWeek][currentDay].customExercises.splice(index, 1);
            saveData(data);
            showDay(currentDay);
        }

        function showAddExerciseModal() {
            document.getElementById('addExerciseModal').classList.add('active');
            document.getElementById('newExerciseName').value = '';
            document.getElementById('newExerciseSets').value = '';
            document.getElementById('newExerciseName').focus();
        }

        function hideAddExerciseModal() {
            document.getElementById('addExerciseModal').classList.remove('active');
        }

        function addCustomExercise() {
            const name = document.getElementById('newExerciseName').value.trim();
            const sets = document.getElementById('newExerciseSets').value.trim() || '3x10';

            if (!name) return;

            const data = getData();
            if (!data.weeks[currentWeek][currentDay].customExercises) {
                data.weeks[currentWeek][currentDay].customExercises = [];
            }

            data.weeks[currentWeek][currentDay].customExercises.push({
                name: name,
                sets: sets,
                completed: false,
                weight: '',
                isCustom: true
            });

            saveData(data);
            hideAddExerciseModal();
            showDay(currentDay);
        }

        function openYouTube(exercise) {
            const query = encodeURIComponent(`${exercise} form tutorial`);
            window.open(`https://www.youtube.com/results?search_query=${query}`, '_blank');
        }

        function showHome() {
            document.getElementById('homeView').classList.remove('hidden');
            document.getElementById('dayDetail').classList.remove('active');
            currentDay = null;
            renderDayCards();
        }

        // Bodyweight functions
        function addBodyweight() {
            const input = document.getElementById('bodyweightInput');
            const weight = parseFloat(input.value);

            if (isNaN(weight) || weight <= 0) return;

            const data = getData();
            const today = new Date().toISOString().split('T')[0];

            data.bodyweight.unshift({ date: today, weight: weight });
            saveData(data);

            input.value = '';
            renderBodyweightLog();
        }

        function renderBodyweightLog() {
            const data = getData();
            const container = document.getElementById('weightLog');

            if (data.bodyweight.length === 0) {
                container.innerHTML = '<div style="color: var(--text-dim); text-align: center; padding: 20px;">No entries yet</div>';
                return;
            }

            container.innerHTML = data.bodyweight.slice(0, 10).map((entry, i) => {
                const date = new Date(entry.date).toLocaleDateString('en-GB', { day: 'numeric', month: 'short' });
                let changeHtml = '';
                if (i < data.bodyweight.length - 1) {
                    const diff = entry.weight - data.bodyweight[i + 1].weight;
                    if (diff !== 0) {
                        const sign = diff > 0 ? '+' : '';
                        const cls = diff < 0 ? 'down' : 'up';
                        changeHtml = `<span class="weight-change ${cls}">${sign}${diff.toFixed(1)}</span>`;
                    }
                }
                return `
                    <div class="weight-entry">
                        <span class="weight-date">${date}</span>
                        <span class="weight-value">${entry.weight} kg${changeHtml}</span>
                    </div>
                `;
            }).join('');
        }

        // Food functions
        function changeDate(delta) {
            currentDate.setDate(currentDate.getDate() + delta);
            document.getElementById('dateLabel').textContent = formatDate(currentDate);
            loadFoodData();
        }

        function loadFoodData() {
            const data = getData();
            const key = getDateKey(currentDate);
            const dayMeals = data.meals[key] || { meal1: {}, meal2: {} };
            const notes = data.foodNotes[key] || '';

            document.getElementById('meal1Protein').value = dayMeals.meal1.protein || '';
            document.getElementById('meal1Veg').value = dayMeals.meal1.veg || '';
            document.getElementById('meal1Clean').className = 'meal-checkbox' + (dayMeals.meal1.clean ? ' checked' : '');

            document.getElementById('meal2Protein').value = dayMeals.meal2.protein || '';
            document.getElementById('meal2Veg').value = dayMeals.meal2.veg || '';
            document.getElementById('meal2Clean').className = 'meal-checkbox' + (dayMeals.meal2.clean ? ' checked' : '');

            document.getElementById('foodNotes').value = notes;
            document.getElementById('dateLabel').textContent = formatDate(currentDate);

            const isCheat = data.cheats && data.cheats[key];
            document.getElementById('cheatCheckbox').className = 'meal-checkbox' + (isCheat ? ' checked' : '');
            document.getElementById('cheatNotes').value = (data.cheatNotes && data.cheatNotes[key]) || '';
        }

        function saveMeal(num) {
            const data = getData();
            const key = getDateKey(currentDate);
            if (!data.meals[key]) data.meals[key] = { meal1: {}, meal2: {} };

            const mealKey = 'meal' + num;
            data.meals[key][mealKey] = {
                protein: document.getElementById(`meal${num}Protein`).value,
                veg: document.getElementById(`meal${num}Veg`).value,
                clean: data.meals[key][mealKey]?.clean || false
            };
            saveData(data);
        }

        function toggleMealClean(num) {
            const data = getData();
            const key = getDateKey(currentDate);
            if (!data.meals[key]) data.meals[key] = { meal1: {}, meal2: {} };

            const mealKey = 'meal' + num;
            if (!data.meals[key][mealKey]) data.meals[key][mealKey] = {};
            data.meals[key][mealKey].clean = !data.meals[key][mealKey].clean;
            saveData(data);

            const el = document.getElementById(`meal${num}Clean`);
            el.className = 'meal-checkbox' + (data.meals[key][mealKey].clean ? ' checked' : '');
        }

        function saveFoodNotes() {
            const data = getData();
            const key = getDateKey(currentDate);
            data.foodNotes[key] = document.getElementById('foodNotes').value;
            saveData(data);
        }

        function toggleCheat() {
            const data = getData();
            const key = getDateKey(currentDate);
            if (!data.cheats) data.cheats = {};
            data.cheats[key] = !data.cheats[key];
            saveData(data);
            document.getElementById('cheatCheckbox').className = 'meal-checkbox' + (data.cheats[key] ? ' checked' : '');
        }

        function saveCheatNotes() {
            const data = getData();
            const key = getDateKey(currentDate);
            if (!data.cheatNotes) data.cheatNotes = {};
            data.cheatNotes[key] = document.getElementById('cheatNotes').value;
            saveData(data);
        }

        function openClaude() {
            const prompt = "Is this meal Rodzen protocol compliant? Rules: no sugar, no carbs, no root vegetables. Only protein + veg that grows above ground.";

            if (navigator.clipboard) {
                navigator.clipboard.writeText(prompt).then(() => {
                    alert("Prompt copied!\n\n1. Open Claude app\n2. Take/attach food photo\n3. Paste the prompt");
                }).catch(() => {
                    alert("Open Claude app, snap your meal photo, and ask:\n\n" + prompt);
                });
            } else {
                alert("Open Claude app, snap your meal photo, and ask:\n\n" + prompt);
            }
        }

        // Backup & Restore functions
        function exportData() {
            const data = getData();
            const jsonStr = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `100kg-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    saveData(data);
                    alert('Backup restored successfully!');
                    location.reload();
                } catch (err) {
                    alert('Error restoring backup. Make sure the file is valid.');
                }
            };
            reader.readAsText(file);
        }

        // Habits functions
        function changeHabitDate(delta) {
            habitDate.setDate(habitDate.getDate() + delta);
            document.getElementById('habitDateLabel').textContent = formatDate(habitDate);
            renderHabits();
        }

        function renderHabits() {
            const data = getData();
            if (!data.habits || data.habits.length === 0) {
                data.habits = defaultHabits.slice();
                saveData(data);
            }

            const key = getDateKey(habitDate);
            const dayHabits = data.habitLog[key] || {};

            const container = document.getElementById('habitsList');
            container.innerHTML = data.habits.map((habit, i) => {
                const completed = dayHabits[i] || false;
                const streak = getHabitStreak(i);
                return `
                    <div class="habit-item">
                        <div class="habit-checkbox ${completed ? 'checked' : ''}" onclick="toggleHabit(${i})"></div>
                        <span class="habit-name ${completed ? 'completed' : ''}">${habit}</span>
                        ${streak > 1 ? `<span class="habit-streak">${streak} days</span>` : ''}
                        <button class="delete-btn" onclick="deleteHabit(${i})">√ó</button>
                    </div>
                `;
            }).join('');

            document.getElementById('habitDateLabel').textContent = formatDate(habitDate);
        }

        function getHabitStreak(habitIndex) {
            const data = getData();
            let streak = 0;
            let checkDate = new Date(habitDate);

            while (true) {
                const key = getDateKey(checkDate);
                const dayHabits = data.habitLog[key];
                if (dayHabits && dayHabits[habitIndex]) {
                    streak++;
                    checkDate.setDate(checkDate.getDate() - 1);
                } else {
                    break;
                }
            }
            return streak;
        }

        function toggleHabit(index) {
            const data = getData();
            const key = getDateKey(habitDate);
            if (!data.habitLog[key]) data.habitLog[key] = {};
            data.habitLog[key][index] = !data.habitLog[key][index];
            saveData(data);
            renderHabits();
        }

        function addHabit() {
            const input = document.getElementById('newHabitInput');
            const habit = input.value.trim();
            if (!habit) return;

            const data = getData();
            if (!data.habits) data.habits = [];
            data.habits.push(habit);
            saveData(data);

            input.value = '';
            renderHabits();
        }

        function deleteHabit(index) {
            const data = getData();
            data.habits.splice(index, 1);
            saveData(data);
            renderHabits();
        }

        // Review functions
        function changeReviewWeek(delta) {
            reviewWeek = Math.max(1, reviewWeek + delta);
            document.getElementById('reviewWeekLabel').textContent = `Week ${reviewWeek}`;
            updateReviewStats();
        }

        function updateReviewStats() {
            const data = getData();
            document.getElementById('reviewWeekLabel').textContent = `Week ${reviewWeek}`;

            // Workout stats
            let daysCompleted = 0;
            let totalExercises = 0;
            let completedExercises = 0;

            const weekData = data.weeks[reviewWeek];
            if (weekData) {
                dayOrder.forEach(day => {
                    if (weekData[day]) {
                        const dayInfo = weekDays[day];
                        if (dayInfo.isPT) {
                            if (weekData[day].completed) daysCompleted++;
                        } else if (!dayInfo.isRest) {
                            const allEx = [...(weekData[day].exercises || []), ...(weekData[day].customExercises || [])];
                            const dayComplete = allEx.length > 0 && allEx.every(e => e.completed);
                            if (dayComplete) daysCompleted++;
                            totalExercises += allEx.length;
                            completedExercises += allEx.filter(e => e.completed).length;
                        }
                    }
                });
            }

            const workoutPercent = totalExercises > 0 ? Math.round((completedExercises / totalExercises) * 100) : 0;

            document.getElementById('workoutStats').innerHTML = `
                <div class="stat-row">
                    <span class="stat-label">Days Completed</span>
                    <span class="stat-value ${daysCompleted >= 4 ? 'good' : daysCompleted >= 2 ? 'neutral' : 'bad'}">${daysCompleted}/5</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Exercise Completion</span>
                    <span class="stat-value ${workoutPercent >= 80 ? 'good' : workoutPercent >= 50 ? 'neutral' : 'bad'}">${workoutPercent}%</span>
                </div>
            `;

            // Diet stats (for selected week)
            let cleanMeals = 0;
            let totalMeals = 0;
            let daysWithNotes = 0;

            const weekStartDate = getWeekStartDate(reviewWeek);

            for (let i = 0; i < 7; i++) {
                const checkDate = new Date(weekStartDate);
                checkDate.setDate(weekStartDate.getDate() + i);
                const key = getDateKey(checkDate);

                if (data.meals[key]) {
                    if (data.meals[key].meal1?.protein) {
                        totalMeals++;
                        if (data.meals[key].meal1?.clean) cleanMeals++;
                    }
                    if (data.meals[key].meal2?.protein) {
                        totalMeals++;
                        if (data.meals[key].meal2?.clean) cleanMeals++;
                    }
                }
                if (data.cheats && data.cheats[key]) {
                    daysWithNotes++;
                }
            }

            const dietPercent = totalMeals > 0 ? Math.round((cleanMeals / totalMeals) * 100) : 0;

            document.getElementById('dietStats').innerHTML = `
                <div class="stat-row">
                    <span class="stat-label">Clean Meals</span>
                    <span class="stat-value ${dietPercent >= 90 ? 'good' : dietPercent >= 70 ? 'neutral' : 'bad'}">${cleanMeals}/${totalMeals} (${dietPercent}%)</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Cheat Days Logged</span>
                    <span class="stat-value ${daysWithNotes === 0 ? 'good' : daysWithNotes <= 2 ? 'neutral' : 'bad'}">${daysWithNotes}</span>
                </div>
            `;

            // Habit stats (for selected week)
            let habitDays = 0;
            let perfectDays = 0;
            const numHabits = data.habits?.length || 4;

            for (let i = 0; i < 7; i++) {
                const checkDate = new Date(weekStartDate);
                checkDate.setDate(weekStartDate.getDate() + i);
                const key = getDateKey(checkDate);

                if (data.habitLog[key]) {
                    const completed = Object.values(data.habitLog[key]).filter(v => v).length;
                    if (completed > 0) habitDays++;
                    if (completed >= numHabits) perfectDays++;
                }
            }

            document.getElementById('habitStats').innerHTML = `
                <div class="stat-row">
                    <span class="stat-label">Days with Habits Done</span>
                    <span class="stat-value ${habitDays >= 6 ? 'good' : habitDays >= 4 ? 'neutral' : 'bad'}">${habitDays}/7</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Perfect Days (All Habits)</span>
                    <span class="stat-value ${perfectDays >= 5 ? 'good' : perfectDays >= 3 ? 'neutral' : 'bad'}">${perfectDays}/7</span>
                </div>
            `;

            // Weight stats
            const recentWeights = data.bodyweight.slice(0, 7);
            let weightChange = 0;
            let currentWeight = 0;

            if (recentWeights.length >= 2) {
                currentWeight = recentWeights[0].weight;
                const startWeight = recentWeights[recentWeights.length - 1].weight;
                weightChange = currentWeight - startWeight;
            } else if (recentWeights.length === 1) {
                currentWeight = recentWeights[0].weight;
            }

            document.getElementById('weightStats').innerHTML = `
                <div class="stat-row">
                    <span class="stat-label">Current Weight</span>
                    <span class="stat-value">${currentWeight ? currentWeight + ' kg' : 'No data'}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Weekly Change</span>
                    <span class="stat-value ${weightChange < 0 ? 'good' : weightChange > 0 ? 'bad' : 'neutral'}">
                        ${weightChange !== 0 ? (weightChange > 0 ? '+' : '') + weightChange.toFixed(1) + ' kg' : 'No change'}
                    </span>
                </div>
            `;

            document.getElementById('verdict').style.display = 'none';
        }

        function generateVerdict() {
            const data = getData();
            let issues = [];
            let wins = [];

            // Check workouts
            const weekData = data.weeks[reviewWeek];
            let daysCompleted = 0;

            if (weekData) {
                dayOrder.forEach(day => {
                    if (weekData[day]) {
                        const dayInfo = weekDays[day];
                        if (dayInfo.isPT && weekData[day].completed) daysCompleted++;
                        else if (!dayInfo.isRest && !dayInfo.isPT) {
                            const allEx = [...(weekData[day].exercises || []), ...(weekData[day].customExercises || [])];
                            if (allEx.length > 0 && allEx.every(e => e.completed)) daysCompleted++;
                        }
                    }
                });
            }

            if (daysCompleted < 3) {
                issues.push(`You only completed ${daysCompleted}/5 workout days. That's not going to cut it.`);
            } else if (daysCompleted >= 4) {
                wins.push(`${daysCompleted}/5 workout days completed.`);
            }

            // Check diet (for selected week)
            let cleanMeals = 0;
            let totalMeals = 0;
            let cheats = [];

            const weekStartDate = getWeekStartDate(reviewWeek);

            for (let i = 0; i < 7; i++) {
                const checkDate = new Date(weekStartDate);
                checkDate.setDate(weekStartDate.getDate() + i);
                const key = getDateKey(checkDate);

                if (data.meals[key]) {
                    if (data.meals[key].meal1?.protein) {
                        totalMeals++;
                        if (data.meals[key].meal1?.clean) cleanMeals++;
                    }
                    if (data.meals[key].meal2?.protein) {
                        totalMeals++;
                        if (data.meals[key].meal2?.clean) cleanMeals++;
                    }
                }
                if (data.cheats && data.cheats[key]) {
                    cheats.push(key);
                }
            }

            const dietPercent = totalMeals > 0 ? Math.round((cleanMeals / totalMeals) * 100) : 0;

            if (totalMeals === 0) {
                issues.push("You didn't log any meals. Can't track what you don't measure.");
            } else if (dietPercent < 80) {
                issues.push(`Only ${dietPercent}% clean meals. The carbs and sugar are keeping the fat on.`);
            } else {
                wins.push(`${dietPercent}% diet compliance.`);
            }

            if (cheats.length > 2) {
                issues.push(`${cheats.length} days with slip-ups logged. You know what you did.`);
            }

            // Check habits (for selected week)
            let perfectDays = 0;
            const numHabits = data.habits?.length || 4;

            for (let i = 0; i < 7; i++) {
                const checkDate = new Date(weekStartDate);
                checkDate.setDate(weekStartDate.getDate() + i);
                const key = getDateKey(checkDate);

                if (data.habitLog[key]) {
                    const completed = Object.values(data.habitLog[key]).filter(v => v).length;
                    if (completed >= numHabits) perfectDays++;
                }
            }

            if (perfectDays < 4) {
                issues.push(`Only ${perfectDays}/7 days with all habits done. The basics matter.`);
            } else {
                wins.push(`${perfectDays}/7 perfect habit days.`);
            }

            // Check weight
            const recentWeights = data.bodyweight.slice(0, 7);
            if (recentWeights.length >= 2) {
                const weightChange = recentWeights[0].weight - recentWeights[recentWeights.length - 1].weight;
                if (weightChange > 0.5) {
                    issues.push(`Weight went UP ${weightChange.toFixed(1)}kg. Something's not working.`);
                } else if (weightChange < -0.3) {
                    wins.push(`Down ${Math.abs(weightChange).toFixed(1)}kg this week.`);
                }
            } else {
                issues.push("Not enough weight data. Weigh yourself weekly minimum.");
            }

            // Generate verdict
            let verdict = '';

            if (issues.length === 0 && wins.length > 0) {
                verdict = `<span class="highlight">You're doing the work.</span> ${wins.join(' ')} Keep this up and the fat has no choice but to leave. Stay consistent.`;
            } else if (issues.length === 0) {
                verdict = "Not enough data to judge. Start logging your meals, workouts, and weight properly.";
            } else {
                verdict = `<span class="highlight">Here's why you're still fat:</span><br><br>`;
                verdict += issues.map(i => `‚Ä¢ ${i}`).join('<br>');

                if (wins.length > 0) {
                    verdict += `<br><br><span class="highlight">What's working:</span><br>`;
                    verdict += wins.map(w => `‚Ä¢ ${w}`).join('<br>');
                }

                verdict += `<br><br>Fix the issues above. No excuses. The gut won't fuck itself off.`;
            }

            document.getElementById('verdictText').innerHTML = verdict;
            document.getElementById('verdict').style.display = 'block';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderDayCards();
            renderBodyweightLog();

            // Register service worker for offline use
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./sw.js')
                    .then(() => console.log('SW registered'))
                    .catch(err => console.log('SW failed:', err));
            }
        });
    </script>
</body>
</html>
